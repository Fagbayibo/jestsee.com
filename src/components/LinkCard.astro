---
import Image from '@/components/Image'
import client from '@/lib/client'

import Link from './Link/Link.astro'

interface Props {
  url: string
  class?: string
}

const { url, class: className } = Astro.props

const metadata = await client.api['link-metadata']
  .$get({ query: { url } })
  .then((res) => res.json())

if (!metadata.success) return

// TODO: get remote image

const aspectRatio =
  metadata.image?.width && metadata.image?.height
    ? `${metadata.image.width}/${metadata.image.height}`
    : '2/1'
---

<Link
  target='_blank'
  href={url}
  class:list={[
    'not-prose flex h-full max-h-[144px] overflow-clip rounded-xl',
    'bg-zinc-900 outline outline-zinc-800 hover:outline-2',
    'group relative transition-all',
    'max-md:flex-col-reverse',
    className
  ]}
>
  <span
    style='transition-duration: 800ms;'
    class:list={[
      'max-md:hidden',
      'absolute right-0 z-30 -mt-8 h-52 w-28 rotate-[24deg] bg-white opacity-[0.01]',
      'translate-x-32 transition-all ease-out',
      'group-hover:-translate-x-[520px]'
    ]}></span>
  <div class='space-y-2 p-4'>
    <p
      class='line-clamp-2 text-sm font-medium leading-snug tracking-wide text-slate-50'
    >
      {metadata.title}
    </p>
    <p class='line-clamp-2 text-xs leading-normal text-slate-300'>
      {metadata.description}
    </p>
    <div class='flex gap-2 pt-1 text-xs'>
      {
        metadata.faviconUrl && (
          <Image
            class='w-4'
            src={metadata.faviconUrl}
            alt={metadata.title ?? url}
            height={16}
            width={16}
            inferSize
          />
        )
      }
      <p class='text-slate-300/50 transition-all group-hover:text-slate-300'>
        {url}
      </p>
    </div>
  </div>
  {
    metadata.image && (
      <Image
        wrapperClass='h-full'
        style={{ aspectRatio }}
        src={metadata.image.url}
        alt={metadata.image.alt ?? url}
        inferSize
      />
    )
  }
  <!-- <div class='h-full bg-gray-400' style='aspect-ratio: 2/1;'>
  </div> -->
</Link>
